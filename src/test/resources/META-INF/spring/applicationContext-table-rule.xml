<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:ddl="http://www.alibaba.com/schema/ddl" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:mybatis="http://mybatis.org/schema/mybatis-spring"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd
		http://www.alibaba.com/schema/ddl http://www.alibaba.com/schema/ddl.xsd 
		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.2.xsd http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd"
	default-lazy-init="false">

	<!-- 配置数据源开始 -->
	<ddl:sharding-datasource id="shardingDataSource">
		<ddl:db-partitions>
			<ddl:db-partition name="dataSource0" read-strategy="polling" >
				<ddl:db-master ref="dataSource0" weight="200" />
				<ddl:db-readonly ref="dataSource0" weight="200" />
				<ddl:db-readonly ref="dataSource0" weight="400" />
			</ddl:db-partition>
			<ddl:db-partition name="partition1">
				<ddl:db-master ref="dataSource1" />
			</ddl:db-partition>
			<ddl:db-partition name="partition2">
				<ddl:db-master ref="dataSource2" />
			</ddl:db-partition>
		</ddl:db-partitions>
	</ddl:sharding-datasource>
	
	<ddl:sharding-table id="shardingTable">
		<ddl:table-global name="stock" partitions="dataSource0,dataSource2,dataSource2"></ddl:global-table>
		<ddl:table-logic name="t_order" suffixies="_${0..3}" strategy="orderTableStrategy">
			<ddl:table-logic name="t_order_item" suffixies="inherit" strategy="inherit"></ddl:logic-table>
		</ddl:table-logic>
	</ddl:sharding-table>
	
	<ddl:sharding-strategy id="orderTableStrategy" columns="order_id" expression="t_order_${order_id.longValue() % 4}"/>
	
</beans>